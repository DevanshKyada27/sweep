# Deploying your own Sweep instance via Docker

*ðŸŽ‰ We recently changed our license to the Elastic License V2 to allow Sweep for commercial usage.*<br/>You can self-host Sweep by deploying our Docker image at https://ghcr.io/sweepai/sweep.

## 0. Pre-requisites

You need an OpenAI API key (GPT-4 32k access helps!), and [GitHub developer mode](https://github.com/settings/apps).

You also need to install [Docker](https://docs.docker.com/engine/install/) to host Sweep.

Pull our image from Docker Hub (it may take 5-10 minutes to download the image):

```sh
docker pull sweepai/sweep:latest
```

## 1. Setting up the GitHub App (5 min)

### Option a: Automatic Setup (Recommended)

Firstly, you need `npm`. If you don't have it, install [here](https://docs.npmjs.com/downloading-and-installing-node-js-and-npm).

Then, run the following commands:

```sh
git clone https://github.com/sweepai/sweep
cd sweep/self_deploy
npm install
npm start
```

This will start a local server at http://localhost:3000. Then,
1. Click the "Register GitHub App" button.
2. Click the green "Create GitHub App for USERNAME" button.
3. Pick where to install the app and then click the green "Install" button. This will take you to the app settings page.
4. Click the small "App settings" button.

![image](/deployment/appsettings.png)

Now run `cat sweep/self_deploy/.env` to get a file containing your PEM, named `PRIVATE_KEY` in this file and your app ID, named `APP_ID`. You will need these for step 2.

If you've made it this far, you can skip to step 2. Otherwise, you may have to set it up manually.

### Option b: Manual Setup (15 min)
Register a new GitHub App, following this [guide](https://docs.github.com/en/apps/creating-github-apps/registering-a-github-app/registering-a-github-app) (3 minutes). You should return here after step 16(it's not as bad as it seems, most steps are optional).

Use the below as a reference:

Set the Repository Permissions (7 selected):

| Scope            | Permissions      |
|------------------|------------------|
| actions          | read             |
| checks           | read             |
| contents         | read & write     |
| commit statuses  | read & write     |
| issues           | read & write     |
| metadata         | read             |
| pull requests    | read & write     |
| workflows        | read & write     |


| Subscribe to events      |
|--------------------------|
| check run                |
| check suite              |
| commit comment           |
| create                   |
| issue comment            |
| issues                   |
| label                    |
| pull request             |
| pull request review      |
| pull request review comment|
| pull request thread      |
| push                     |
| status                   |
| workflow job             |
| workflow run             |

Put a placeholder url for now (ex: https://github.com/sweepai/sweep/).
Generate a private key (it should prompt you at the top of the screen, or alternatively follow [this guide](https://docs.github.com/en/apps/creating-github-apps/authenticating-with-a-github-app/managing-private-keys-for-github-apps)) and save it for later. This is your `private-key.pem` for step 2.

![image](/deployment/pem.png)

Click Install App to install it on your account or organization. Point it to a repo which you want to use Sweep on. This repo cannot be empty. If you don't have a good repo at hand, check out our [tutorial on running Sweep on Docusaurus](https://docs.sweep.dev/tutorial).

## 2. Running the Webhook (5 min)

*Starting here it gets more involved so if you run into issues, please reach out to us on [Discord](https://discord.gg/sweep) or open a GitHub issue (ironic, we know!) at https://github.com/sweepai/sweep/issues. We are online, please ping us @kevin, @william, and @luke.*

Now create the following `.env` file with the new secrets.

First, pass your PEM through this script in order to get the base64 encoded version of it. You can also use the `base64` command on Linux and MacOS.

```
base64 -i private-key.pem
```
or the Python script
```python
import base64
with open("private-key.pem", "rb") as f:
    print(base64.b64encode(f.read()).decode())
```

Finally, create a `.env` file with the following contents:
```sh
GITHUB_APP_PEM_BASE64="OUTPUT OF ABOVE SCRIPT"
# 6 digit ID
GITHUB_APP_ID=123456 # Replace with your app ID from the .env from the first step if you did option a or the below screenshot

# Should start with "sk-"
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
# Set to true if you have access to 32k model
OPENAI_DO_HAVE_32K_MODEL_ACCESS=false
```

![image](/deployment/appid.png)

Then in the same directory as the `.env`, run:

```bash
docker run --env-file .env -p 8000:8000 sweepai/sweep:latest
```

## 3. Connecting the Webhook to the App (10 min)

{/* <p style={{marginTop: 16, marginBottom: 32}}>
    <a href="https://cloud.digitalocean.com/apps/new?repo=https://github.com/sweepai/sweep/tree/main">
        <img src="https://www.deploytodo.com/do-btn-blue-ghost.svg" alt="Deploy to DO"/>
    </a>
</p>  */}

From here, you can either deploy the webhook locally or in production. For the rest of this guide, we'll assume you're serving locally using [Ngrok](https://ngrok.com/) for a reverse proxy.

Sign up for an Ngrok account and install the CLI from https://dashboard.ngrok.com/signup. Your terminal must be in the same directory as your ngrok installation. Start the reverse proxy with `./ngrok http 8000`. The second last line should say something like

```sh
Forwarding  https://4d8d8bf053be.ngrok.app -> http://localhost:8000
```

With the webhook URL, go back to the GitHub Apps settings (`https://github.com/USERNAME/settings/apps/APP_NAME/advanced`) and replace the "Webhook URL" field with https://4d8d8bf053be.ngrok.app(your version). Ensure SSL verification remains active.

## 4. Running Sweep (1 min)

Finally, you can try out Sweep by going to "https://github.com/USERNAME/settings/apps/APP_NAME/installations" to install your repo to the app. You can then try out Sweep by creating a new issue with a title prefixed with `Sweep:`, like `Sweep: write unit tests for BaseIndex.tsx` and watch the magic happen!

For more details on using Sweep, see our [tutorial](https://docs.sweep.dev/usage/tutorial) and [advanced usage](https://docs.sweep.dev/usage/advanced) guides.

---

*There's additional configurable settings like Redis caching and GPU-accelerated embeddings that we use for our hosted product that we can document further for self-hosting. If this interests you please contact us at https://discord.gg/sweep.*
